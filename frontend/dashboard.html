{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Deliciae</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/search.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Mobile Specific Overrides */
        @media (max-width: 768px) {
            .main-content {
                margin-left: 0 !important;
                padding-bottom: 80px !important; /* Space for bottom nav */
                padding-top: 20px !important;
            }
            .sidebar {
                display: none !important;
            }
        }
        
        /* Desktop Specific */
        @media (min-width: 769px) {
            .main-content {
                margin-left: 240px; /* Match sidebar width */
            }
        }

        /* Gradient Text */
        .text-gradient {
            background: linear-gradient(to right, #FF6B35, #FFC107);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body class="dashboard-body bg-[#0d0d10] text-white min-h-screen">

    <!-- Decorative BG -->
    <div class="glow-bg top-left" style="opacity: 0.5;"></div>
    <div class="glow-bg bottom-right" style="opacity: 0.5;"></div>

    <!-- UTILITY MODALS (Hidden by default) -->
    
    <!-- Upload Reel Modal -->
    <div id="uploadReelModal" class="modal">
        <div class="modal-content glass-card">
            <span class="close" onclick="closeUploadReelModal()">&times;</span>
            <h2>Upload a Reel</h2>
            <form id="uploadReelForm" onsubmit="handleReelUpload(event)">
                <div class="form-group">
                    <label>Video File</label>
                    <input type="file" id="reelVideoFile" accept="video/*" required>
                </div>
                <div class="form-group">
                    <label>Caption</label>
                    <textarea id="reelCaption" rows="3" placeholder="Write a catchy caption..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Upload Reel</button>
            </form>
        </div>
    </div>

    <!-- Booking Modal -->
    <div id="bookingModal" class="modal">
        <div class="modal-content glass-card">
            <span class="close" onclick="closeBookingModal()">&times;</span>
            <h2>Book a Table</h2>
            <p id="bookingRestaurantName" style="color: var(--accent-primary); margin-bottom: 1rem;"></p>
            <form id="bookingForm" onsubmit="handleBookingSubmit(event)">
                <input type="hidden" id="bookingRestaurantId">
                <div class="form-group">
                    <label>Date & Time</label>
                    <input type="datetime-local" id="bookingDateTime" class="form-input" required>
                </div>
                <div class="form-group">
                    <label>Number of People</label>
                    <input type="number" id="bookingPeople" class="form-input" min="1" max="20" value="2" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Confirm Booking</button>
            </form>
        </div>
    </div>

    <!-- Add Food Modal (Restaurant Only) -->
    <div id="addFoodModal" class="modal">
        <div class="modal-content glass-card">
            <span class="close-modal" onclick="closeAddFoodModal()">&times;</span>
            <h2>Add New Item</h2>
            <form>
                <div class="form-group">
                    <label>Item Name</label>
                    <input type="text" id="newItemName" class="form-input" placeholder="e.g. Seafood Pasta">
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="newItemCategory" class="form-input" style="background: rgba(255,255,255,0.05); color: white;">
                        <option>Italian</option>
                        <option>Indian</option>
                        <option>Mexican</option>
                        <option>Chinese</option>
                        <option>Desserts</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Price (â‚¹)</label>
                    <input type="number" id="newItemPrice" class="form-input" placeholder="10.00">
                </div>
                <!-- Optional Video URL for now -->
                <div class="form-group">
                    <label>Video URL (Optional)</label>
                    <input type="text" id="newItemVideo" class="form-input" placeholder="Reel URL">
                </div>
                
                <button type="button" class="btn btn-primary btn-full" onclick="addFoodItem()">Add Item</button>
            </form>
        </div>
    </div>

    <!-- Restaurant Profile Modal (Public View) -->
    <div id="restaurantProfileModal" class="modal" style="z-index: 2000;">
        <div class="modal-content glass-card" style="width: 95%; max-width: 900px; height: 90vh; overflow-y: auto; margin: 2% auto; background: #111;">
            <span class="close-modal" onclick="document.getElementById('restaurantProfileModal').style.display='none'">&times;</span>
            <div id="profile-header" style="text-align: center; margin-bottom: 2rem;"></div>
            <div class="profile-tabs" style="display: flex; justify-content: center; gap: 2rem; margin-bottom: 2rem; border-bottom: 1px solid var(--glass-border); padding-bottom: 1rem;">
                <a href="#" class="tab-link active" onclick="switchProfileTab('posts'); return false;"><i class="fas fa-th"></i> Posts</a>
                <a href="#" class="tab-link" onclick="switchProfileTab('menu'); return false;"><i class="fas fa-utensils"></i> Menu</a>
            </div>
            <div id="profile-body"></div>
        </div>
    </div>


    <div class="dashboard-container">
        
        <!-- SIDEBAR & NAVIGATION LOGIC -->
        {% if user.role == 'restaurant' %}
            {% include 'components/restaurant_sidebar.html' %}
            {% include 'components/restaurant_mobile_nav.html' %}
        {% else %}
            {% include 'components/sidebar.html' %}
            {% include 'components/mobile_bottom_nav.html' %}
        {% endif %}

        <!-- MAIN CONTENT -->
        <main class="main-content p-4 md:p-8">
            
            <!-- HEADER -->
            <header class="dashboard-header flex justify-between items-center mb-8">
                <div class="header-text">
                    <h1 class="text-3xl font-bold">Hi, {{ user.first_name|default:user.username }}! ðŸ‘‹</h1>
                    <p class="text-gray-400">
                        {% if user.role == 'restaurant' %}
                            Here's what's happening today
                        {% else %}
                            What are you craving today? ðŸ˜‹
                        {% endif %}
                    </p>
                </div>

                {% if user.role == 'restaurant' %}
                <!-- Restaurant Actions (Desktop Only - Mobile has FAB) -->
                <div class="hidden md:flex gap-3">
                    <button class="btn btn-glass" onclick="openAddFoodModal()">
                        <i class="fas fa-plus"></i> Add Item
                    </button>
                    <button class="btn btn-glass" onclick="openUploadReelModal()">
                        <i class="fas fa-video"></i> Upload Reel
                    </button>
                </div>
                {% else %}
                <!-- Customer Actions -->
                <div class="hidden md:flex gap-3">
                    <div class="relative">
                         <input type="text" id="searchInput" placeholder="Search..." class="bg-white/5 border border-white/10 rounded-full px-4 py-2 text-sm focus:outline-none focus:border-[#FF6B35]">
                         <i class="fas fa-search absolute right-3 top-2.5 text-gray-400"></i>
                    </div>
                </div>
                {% endif %}
            </header>

            {% if user.role == 'restaurant' %}
                <!-- RESTAURANT DASHBOARD VIEWS -->
                
                <!-- 1. OVERVIEW VIEW -->
                <div id="overview-view" class="dashboard-section">
                    <!-- Premium Stats Grid -->
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                        <!-- Total Orders -->
                        <div class="glass-card p-6 rounded-2xl relative overflow-hidden group">
                            <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                                <i class="fas fa-shopping-cart text-6xl text-[#FF6B35]"></i>
                            </div>
                            <span class="text-gray-400 text-sm mb-1 block">Total Orders Today</span>
                            <span class="text-3xl font-bold text-white">145</span>
                            <div class="mt-2 text-xs text-green-400 flex items-center gap-1">
                                <i class="fas fa-arrow-up"></i> 12% from yesterday
                            </div>
                        </div>

                        <!-- Revenue -->
                        <div class="glass-card p-6 rounded-2xl relative overflow-hidden group">
                            <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                                <i class="fas fa-wallet text-6xl text-green-500"></i>
                            </div>
                            <span class="text-gray-400 text-sm mb-1 block">Revenue Today</span>
                            <span class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-green-600">â‚¹12,450</span>
                            <div class="mt-2 text-xs text-green-400 flex items-center gap-1">
                                <i class="fas fa-arrow-up"></i> 8% from yesterday
                            </div>
                        </div>

                        <!-- Rating -->
                        <div class="glass-card p-6 rounded-2xl relative overflow-hidden group">
                             <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                                <i class="fas fa-star text-6xl text-yellow-500"></i>
                            </div>
                            <span class="text-gray-400 text-sm mb-1 block">Average Rating</span>
                            <span class="text-3xl font-bold text-yellow-500">4.5 <span class="text-sm text-gray-500">/ 5</span></span>
                            <div class="mt-2 text-xs text-gray-400">Based on 12 reviews</div>
                        </div>

                        <!-- Followers -->
                        <div class="glass-card p-6 rounded-2xl relative overflow-hidden group">
                             <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                                <i class="fas fa-users text-6xl text-blue-500"></i>
                            </div>
                            <span class="text-gray-400 text-sm mb-1 block">Followers</span>
                            <span class="text-3xl font-bold text-white">2,340</span>
                            <div class="mt-2 text-xs text-green-400 flex items-center gap-1">
                                <i class="fas fa-plus"></i> 15 new today
                            </div>
                        </div>
                    </div>

                    <!-- Charts & Trends -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <!-- Revenue Chart -->
                        <div class="glass-card p-6 rounded-2xl lg:col-span-2">
                            <h3 class="text-lg font-bold mb-4">Weekly Revenue</h3>
                            <canvas id="revenueChart" height="200"></canvas>
                        </div>
                        
                        <!-- AI Insights -->
                        <div class="glass-card p-6 rounded-2xl bg-gradient-to-br from-[#FF6B35]/10 to-transparent border border-[#FF6B35]/20">
                            <div class="flex items-center gap-2 mb-4">
                                <i class="fas fa-robot text-[#FF6B35] text-xl"></i>
                                <h3 class="text-lg font-bold text-[#FF6B35]">AI Insights</h3>
                            </div>
                            <div class="space-y-4">
                                <div class="bg-black/20 p-4 rounded-xl">
                                    <p class="text-sm text-gray-300">ðŸ”¥ <strong>Chicken Biryani</strong> is trending in your area. Consider increasing stock for dinner service.</p>
                                </div>
                                <div class="bg-black/20 p-4 rounded-xl">
                                    <p class="text-sm text-gray-300">ðŸ“Š <strong>Rain Expected Tomorrow</strong>. Soup demand predicted to increase by 18%.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Orders Section -->
                    <div class="mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold">Recent Orders</h3>
                            <a href="#" onclick="showDashboardSection('orders-view')" class="text-[#FF6B35] text-sm hover:underline">View All</a>
                        </div>
                        <div class="glass-card rounded-2xl overflow-hidden">
                            <!-- Header -->
                            <div class="grid grid-cols-12 gap-4 p-4 border-b border-white/5 text-gray-400 text-sm font-medium">
                                <div class="col-span-2">Order ID</div>
                                <div class="col-span-3">User</div>
                                <div class="col-span-3">Items</div>
                                <div class="col-span-2">Status</div>
                                <div class="col-span-2 text-right">Action</div>
                            </div>
                            <!-- Rows (Placeholder Data) -->
                            <div class="grid grid-cols-12 gap-4 p-4 items-center hover:bg-white/5 transition-colors border-b border-white/5">
                                <div class="col-span-2 font-bold">#1245</div>
                                <div class="col-span-3 flex items-center gap-2">
                                    <div class="w-8 h-8 rounded-full bg-gray-700"></div>
                                    <span>Rahul</span>
                                </div>
                                <div class="col-span-3 text-sm text-gray-300">2x Burger</div>
                                <div class="col-span-2"><span class="px-2 py-1 rounded-full text-xs bg-orange-500/20 text-orange-500">Preparing</span></div>
                                <div class="col-span-2 text-right flex justify-end gap-2">
                                    <button class="w-8 h-8 rounded-full bg-green-500/20 text-green-500 hover:bg-green-500/30 flex items-center justify-center transition" title="Mark Ready"><i class="fas fa-check"></i></button>
                                </div>
                            </div>
                             <div class="grid grid-cols-12 gap-4 p-4 items-center hover:bg-white/5 transition-colors">
                                <div class="col-span-2 font-bold">#1244</div>
                                <div class="col-span-3 flex items-center gap-2">
                                    <div class="w-8 h-8 rounded-full bg-gray-700"></div>
                                    <span>Anupama</span>
                                </div>
                                <div class="col-span-3 text-sm text-gray-300">1x Pizza, 1x Coke</div>
                                <div class="col-span-2"><span class="px-2 py-1 rounded-full text-xs bg-green-500/20 text-green-500">Delivered</span></div>
                                <div class="col-span-2 text-right flex justify-end gap-2">
                                    <button class="text-gray-500 hover:text-white text-sm">Details</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 1.5 MENU VIEW (NEW) -->
                <div id="menu-view" class="dashboard-section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold">My Menu</h3>
                        <div class="flex gap-2">
                             <input type="text" placeholder="Search items..." class="bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-[#FF6B35]">
                             <button class="btn btn-primary btn-sm" onclick="openAddFoodModal()"><i class="fas fa-plus"></i> Add</button>
                        </div>
                    </div>
                    <div id="restaurantMenuGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                         <div class="col-span-full text-center py-12 text-gray-500">
                            <i class="fas fa-spinner fa-spin mr-2"></i> Loading your menu...
                        </div>
                    </div>
                </div>

                <!-- 2. KITCHEN VIEW -->
                <div id="kitchen-view" class="dashboard-section hidden">
                    <div class="section-title mb-6">
                        <h3 class="text-xl font-bold">Kitchen Display System</h3>
                    </div>
                    <div class="glass-card p-12 text-center text-gray-500">
                        <i class="fas fa-fire text-4xl mb-4 text-[#FF6B35]"></i>
                        <p class="text-lg">Kitchen view is active. Waiting for orders...</p>
                    </div>
                </div>

                <!-- 3. ORDERS VIEW -->
                <div id="orders-view" class="dashboard-section hidden">
                     <div class="section-title mb-6 flex justify-between items-center">
                        <h3 class="text-xl font-bold">Order Management</h3>
                         <div class="flex gap-2">
                            <button class="px-4 py-2 rounded-full bg-[#FF6B35] text-white text-sm">Active</button>
                            <button class="px-4 py-2 rounded-full bg-white/5 hover:bg-white/10 text-gray-400 text-sm">History</button>
                        </div>
                    </div>
                    <!-- Reuse the same card style from Overview -->
                     <div class="glass-card rounded-2xl overflow-hidden">
                        <div class="grid grid-cols-12 gap-4 p-4 border-b border-white/5 text-gray-400 text-sm font-medium">
                            <div class="col-span-2">Order ID</div>
                            <div class="col-span-3">User</div>
                            <div class="col-span-3">Items</div>
                            <div class="col-span-2">Status</div>
                            <div class="col-span-2 text-right">Action</div>
                        </div>
                        <div class="p-12 text-center text-gray-500">
                            <p>No active orders found.</p>
                        </div>
                    </div>
                </div>

                 <!-- 4. TABLES VIEW -->
                <div id="tables-view" class="dashboard-section hidden">
                     <div class="section-title mb-6 flex justify-between items-center">
                        <h3 class="text-xl font-bold">Table Management</h3>
                        <button class="btn btn-sm btn-glass"><i class="fas fa-plus"></i> Add Table</button>
                    </div>
                    <!-- Calendar / Grid Placeholder -->
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="glass-card p-6 rounded-2xl">
                            <h4 class="font-bold mb-4">Today's Bookings</h4>
                            <div class="space-y-3">
                                <div class="bg-white/5 p-3 rounded-lg flex justify-between items-center">
                                    <div>
                                        <div class="font-bold">Table 4</div>
                                        <div class="text-sm text-gray-400">7:00 PM - 9:00 PM â€¢ 2 Ppl</div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button class="text-green-500 hover:bg-green-500/10 p-2 rounded"><i class="fas fa-check"></i></button>
                                        <button class="text-red-500 hover:bg-red-500/10 p-2 rounded"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                         <div class="glass-card p-6 rounded-2xl flex items-center justify-center text-gray-500">
                            Table Map Visualization
                        </div>
                    </div>
                </div>

                <!-- 5. REELS VIEW -->
                <div id="reels-view" class="dashboard-section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold">Reels & Highlights</h3>
                        <button class="btn btn-primary btn-sm" onclick="openUploadReelModal()"><i class="fas fa-video"></i> Upload</button>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <!-- Placeholder Reel Card -->
                        <div class="glass-card rounded-xl overflow-hidden group relative aspect-[9/16] bg-black">
                            <div class="absolute inset-0 flex items-center justify-center text-gray-600">
                                <i class="fas fa-play text-2xl"></i>
                            </div>
                            <div class="absolute bottom-0 left-0 right-0 p-3 bg-gradient-to-t from-black/80 to-transparent">
                                <p class="text-xs text-white truncate">Delicious Burger Promo</p>
                                <p class="text-[10px] text-gray-400">1.2k views</p>
                            </div>
                             <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button class="bg-black/50 hover:bg-red-500 text-white p-1.5 rounded-full"><i class="fas fa-trash text-xs"></i></button>
                            </div>
                        </div>
                         <div class="glass-card rounded-xl overflow-hidden flex items-center justify-center border-2 border-dashed border-white/10 hover:border-[#FF6B35]/50 cursor-pointer text-gray-500 hover:text-[#FF6B35] transition" onclick="openUploadReelModal()">
                            <div class="text-center">
                                <i class="fas fa-plus text-2xl mb-2"></i>
                                <p class="text-sm">New Reel</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 6. OFFERS VIEW -->
                <div id="offers-view" class="dashboard-section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold">Manage Offers</h3>
                        <button class="btn btn-primary btn-sm"><i class="fas fa-plus"></i> Create Offer</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="glass-card p-6 rounded-2xl border-l-4 border-l-[#FF6B35]">
                             <div class="flex justify-between items-start mb-2">
                                <h4 class="font-bold text-lg">20% OFF on Pizza</h4>
                                <span class="text-xs bg-green-500/20 text-green-500 px-2 py-1 rounded">Active</span>
                            </div>
                            <p class="text-sm text-gray-400 mb-4">Valid till Sunday, 10 PM</p>
                            <div class="flex items-center justify-between mt-4 text-sm">
                                <span class="text-gray-500">Code: PIZZA20</span>
                                <div class="flex gap-2">
                                    <button class="text-gray-400 hover:text-white"><i class="fas fa-pen"></i></button>
                                    <button class="text-gray-400 hover:text-red-500"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 7. REVIEWS VIEW -->
                <div id="reviews-view" class="dashboard-section hidden">
                    <h3 class="text-xl font-bold mb-6">Customer Reviews</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Review Card -->
                        <div class="glass-card p-6 rounded-2xl">
                            <div class="flex justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-full bg-gray-700"></div>
                                    <div>
                                        <h4 class="font-bold text-sm">Anupama</h4>
                                        <div class="text-xs text-gray-400">2 days ago</div>
                                    </div>
                                </div>
                                <div class="text-yellow-500 text-xs">
                                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                                </div>
                            </div>
                            <p class="text-gray-300 text-sm mb-4">"Best food! The Chicken Biryani was absolutely delicious. classic taste."</p>
                            <button class="text-[#FF6B35] text-sm hover:underline">Reply</button>
                        </div>
                    </div>
                </div>

                <!-- 8. FOLLOWERS VIEW -->
                <div id="followers-view" class="dashboard-section hidden">
                    <h3 class="text-xl font-bold mb-6">Your Community</h3>
                    <div class="glass-card p-6 rounded-2xl mb-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="text-gray-400">Total Followers</span>
                                <h2 class="text-4xl font-bold text-white mt-1">2,340</h2>
                            </div>
                            <div class="text-right">
                                <div class="text-green-500 mb-1">+5.2%</div>
                                <span class="text-xs text-gray-500">this month</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 9. ANALYTICS VIEW -->
                <div id="analytics-view" class="dashboard-section hidden">
                    <h3 class="text-xl font-bold mb-6">Detailed Analytics</h3>
                    <div class="glass-card p-12 text-center text-gray-500">
                         <i class="fas fa-chart-pie text-4xl mb-4 opacity-50"></i>
                         <p>Detailed reports and insights coming soon.</p>
                    </div>
                </div>

                <!-- 10. SETTINGS VIEW -->
                <div id="settings-view" class="dashboard-section hidden">
                    <div class="section-title mb-6">
                        <h3 class="text-xl font-bold">Restaurant Settings</h3>
                    </div>
                    <!-- Reuse Settings Form Logic -->
                    {% include 'components/settings_form.html' %} 
                     <div class="glass-card p-6 md:p-8 max-w-2xl mx-auto hidden"> <!-- Hidden backup if component fails -->
                        <form id="settingsFormBackup" onsubmit="event.preventDefault(); saveUserSettings();">
                            <div class="form-group mb-6">
                                <label class="block text-gray-400 mb-2">Restaurant Name</label>
                                <input type="text" id="settingsName" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-[#FF6B35] focus:outline-none" value="{{ user.first_name|default:user.username }}">
                            </div>
                             <div class="form-group mb-6">
                                <label class="block text-gray-400 mb-2">Contact Email</label>
                                <input type="email" id="settingsEmail" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-[#FF6B35] focus:outline-none" value="{{ user.email }}">
                            </div>
                            <button class="btn btn-primary w-full py-3 rounded-xl font-bold">Save Changes</button>
                        </form>
                    </div>
                </div>

            {% else %}
                <!-- CUSTOMER DASHBOARD VIEWS -->
                
                <!-- Home View -->
                <div id="home-view" class="dashboard-section">
                    <!-- Location Filter -->
                    <div class="flex items-center gap-2 mb-6 md:hidden">
                        <i class="fas fa-map-marker-alt text-[#FF6B35]"></i>
                        <span class="text-sm text-gray-300">New York, USA</span> <!-- Dynamic later -->
                        <i class="fas fa-chevron-down text-xs text-gray-500"></i>
                    </div>

                    <!-- Categories -->
                    <div class="flex gap-4 overflow-x-auto pb-4 mb-8 custom-scrollbar">
                        <div class="category-chip active px-6 py-2 rounded-full bg-[#FF6B35] text-white whitespace-nowrap">All</div>
                        <div class="category-chip px-6 py-2 rounded-full bg-white/5 border border-white/10 hover:border-[#FF6B35] transition whitespace-nowrap">Italian</div>
                        <div class="category-chip px-6 py-2 rounded-full bg-white/5 border border-white/10 hover:border-[#FF6B35] transition whitespace-nowrap">Asian</div>
                        <div class="category-chip px-6 py-2 rounded-full bg-white/5 border border-white/10 hover:border-[#FF6B35] transition whitespace-nowrap">Desserts</div>
                    </div>

                    <!-- Restaurants Near You -->
                    <section class="mb-10">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold">Restaurants Uses Near You</h3>
                            <a href="#" class="text-[#FF6B35] text-sm">See all</a>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="restaurantGrid">
                             <div class="col-span-full text-center py-10 text-gray-500">
                                <i class="fas fa-spinner fa-spin mr-2"></i> Loading nearby restaurants...
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Other Customer Views (Reels, Orders, Settings) are handled by JS to toggle visibility -->
                <div id="settings-view" class="dashboard-section hidden">
                    <h3 class="text-xl font-bold mb-6">Settings</h3>
                    <!-- Settings Form Reuse -->
                </div>

            {% endif %}

        </main>
    </div>

    <!-- MAIN SCRIPTS -->
    <script src="{% static 'js/script.js' %}?v=10"></script>
    <script>
        // Init ChartJS
        function initDashboardCharts() {
            const ctx = document.getElementById('revenueChart');
            if(ctx) {
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'Revenue (â‚¹)',
                            data: [12000, 19000, 3000, 5000, 20000, 30000, 45000], // Mock Data
                            borderColor: '#FF6B35',
                            backgroundColor: 'rgba(255, 107, 53, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: '#FF6B35'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#9ca3af' }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: '#9ca3af' }
                            }
                        }
                    }
                });
            }
        }

        // Tab Switching Logic
        function showDashboardSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.dashboard-section').forEach(el => {
                el.classList.add('hidden');
            });
            
            // Show target
            const target = document.getElementById(sectionId);
            if(target) {
                target.classList.remove('hidden');
            }

            // Update Active State in Nav (Sidebar + Mobile)
            updateNavActiveState(sectionId);
        }

        function updateNavActiveState(sectionId) {
            // Sidebar
            document.querySelectorAll('.nav-item, .side-nav a').forEach(el => {
                el.classList.remove('active', 'text-[#FF6B35]', 'bg-[#FF6B35]/10');
                el.classList.add('text-gray-400');
            });

            // Find link with matching onclick or id
            // This is a simple heuristic, ideally use data attributes
            const sidebarLink = document.querySelector(`a[onclick*="${sectionId}"]`);
            if(sidebarLink) {
                sidebarLink.classList.add('active', 'text-[#FF6B35]', 'bg-[#FF6B35]/10');
                sidebarLink.classList.remove('text-gray-400');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
             // Default view
             showDashboardSection('overview-view'); 
             
             // Role specific init
             const userRole = "{{ user.role }}";
             if (userRole === 'restaurant') {
                 initDashboardCharts(); // Init Charts for Restaurant
             } else {
                showDashboardSection('home-view');
                if(window.fetchRestaurants) window.fetchRestaurants();
             }
        });

        // Add Item & Reel Functions (from previous dashboard.html)
        function openAddFoodModal() { document.getElementById('addFoodModal').style.display = 'block'; }
        function closeAddFoodModal() { document.getElementById('addFoodModal').style.display = 'none'; }
        
        function openUploadReelModal() { document.getElementById('uploadReelModal').style.display = 'block'; }
        function closeUploadReelModal() { document.getElementById('uploadReelModal').style.display = 'none'; }

        // Reuse existing logic for Reals Upload & Food Add
        // ... (Include the JS for handleReelUpload etc or ensure it's in script.js)
    </script>
</body>
</html>
